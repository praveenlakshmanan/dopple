
<div class="modal-header">
   <button type="button" class="close" data-dismiss="modal" aria-hidden="true">ÃÂ</button> 
   <h3>Share via Email Periodically</h3>
</div>
<div class="modal-body"><div style="width:100%;margin-top:10px;"><label style="padding-left:15px">Email-id :<input id="service" type="text"style="margin-left:10px"/></label>
<br>
<label style="padding-left:15px;">Type &nbsp;&nbsp;&nbsp;&nbsp; : <select id="type" style="margin-left:5px"><option>png</option><option>pdf</option></select></label>
<br>
<label style="padding-left:15px;">Interval &nbsp;: <select id="interval" style="margin-left:6px"><option>Test</option><option>30m</option><option>1h</option><option>1d</option></select></label>
<table style="margin-left:15px;margin-top:10px;"><tr><td><label>From&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;</label></td><td><input id="date" class="timepicker-date" type="text" ng-change="validate(temptime)" ng-model="temptime.from.date" data-date-format="yyyy-mm-dd" required="" bs-datepicker=""></td><td><select id="hour"  style="margin-left:10px;width:50px;"><option>00</option><option>01</option><option>02</option><option>03</option><option>04</option><option>05</option><option>06</option><option>07</option><option>08</option><option>09</option><option>10</option><option>11</option><option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option><option>19</option><option>20</option><option>21</option><option>22</option><option>23</option></select></td>
<td>&nbsp;&nbsp; : &nbsp;&nbsp;<select id="min" style="width:50px;"><option>00</option><option>05</option><option>10</option><option>15</option><option>20</option><option>25</option><option>30</option><option>35</option><option>40</option><option>45</option><option>50</option><option>55</option></select></td>
<td><button class="btn btn-success" id="start" onclick="service()" style="margin-left:10px;margin-bottom:10px">set as service</button></td><td><button class="btn btn-success" id="stop" onclick="stopservice()" style="margin-left:20px;margin-bottom:10px">stop service</button></td></tr></table>

</div>
</div>
   
<div class="modal-footer"><button id="close-btn" ng-click="dismiss();$broadcast('render')" class="btn btn-success" type="button">Close</button></div>


<script type="text/javascript">
setTimeout(function(){ checkservice(); }, 10000);

function service(){
	var link = document.URL;
	var serviceEmailId = document.getElementById("service").value;
	var date = document.getElementById("date").value;
	var hour = document.getElementById("hour").value;
	var min = document.getElementById("min").value;
	var time = hour+":"+min;
	
	 var idArr = serviceEmailId.split(",");
	   for(i=0;i < idArr.length;i++){
	   	flag = validateEmail(idArr[i]);
	   	
	   	if(flag.toString() == "false"){
	   		    break;
	   	};
	   }
	if(serviceEmailId != "" && flag.toString() =="true"){
		var textField = document.getElementById("service");
		var type = document.getElementById("type").value;
		var interval = document.getElementById("interval").value;
		var title = document.getElementById("brand").value;
		
		textField.style.border = "1px solid #1dade2";
		var xmlhttp;
		if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
 					 xmlhttp=new XMLHttpRequest();
 		}else{// code for IE6, IE5
  			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  		}
		xmlhttp.onreadystatechange=function(){
  			if (xmlhttp.readyState==4 && xmlhttp.status==200){
  				//alert(xmlhttp.responseText);
    		}
  		}
		
	//	alert("time"+time);
	//	alert("date"+date);
		var parameters = "url="+encodeURIComponent(link)+"&id="+encodeURIComponent(serviceEmailId)+"&type="+encodeURIComponent(type)+"&link="+encodeURIComponent(link)+"&interval="+encodeURIComponent(interval)+"&title="+encodeURIComponent(title)+"&time="+encodeURIComponent(time)+"&date="+encodeURIComponent(date);
		//var data = [{"url":link,"type":type}];
		//alert(JSON.stringify(data));al
		
		xmlhttp.open("POST","BackgroundReport",true);
		xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
		xmlhttp.send(parameters)
		document.getElementById("start").disabled = true;
		document.getElementById("stop").disabled = false;
		document.getElementById("close-btn").click();
	}else{
		var textField = document.getElementById("service");
		textField.style.border = "1px solid red";
	}
}


function stopservice(){
	   var title = document.getElementById("brand").value;
		var xmlhttp;
		if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
 					 xmlhttp=new XMLHttpRequest();
 		}else{// code for IE6, IE5
  			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  		}
		xmlhttp.onreadystatechange=function(){
  			if (xmlhttp.readyState==4 && xmlhttp.status==200){
  				//alert(xmlhttp.responseText);
    		}
  		}
		var parameters = "&title="+encodeURIComponent(title);
		//var data = [{"url":link,"type":type}];
		//alert(JSON.stringify(data));al
		
		xmlhttp.open("POST","StopBackgroundService",true);
		xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
		xmlhttp.send(parameters)
		document.getElementById("start").disabled = false;
		document.getElementById("stop").disabled = true;
		document.getElementById("close-btn").click();
}




function checkservice(){
	   var title = document.getElementById("brand").value;
	   //alert(title);
		var xmlhttp;
		if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
					 xmlhttp=new XMLHttpRequest();
		}else{// code for IE6, IE5
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function(){
			if (xmlhttp.readyState==4 && xmlhttp.status==200){
				//alert(xmlhttp.responseText);
				if(xmlhttp.responseText =="true"){
					document.getElementById("start").disabled =true;
					document.getElementById("stop").disabled = false;
				}else{
					document.getElementById("start").disabled = false;
					document.getElementById("stop").disabled = true;
				}
		}
		}
		
		var parameters = "title="+encodeURIComponent(title);
		//var data = [{"url":link,"type":type}];
		//alert(JSON.stringify(data));al
		
		xmlhttp.open("POST","CheckService",true);
		xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
		xmlhttp.send(parameters)
		//document.getElementById("close").click();
}


function validateEmail(isEmail) { 
    var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
    if (filter.test(isEmail)) {
         return true;
       }
    else {
       return false;
     }
 }
</script>